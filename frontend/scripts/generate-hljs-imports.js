import fs from 'fs'

let outTop = 'import {hljs} from "@/utils/highlight"'
let outBottom = ''

const ignoredLangs = ['mathematica', 'gml', '1c', 'isbl', 'pgsql', 'maxima', 'sqf']

let i = 0

function addLang(lang, langFile = undefined) {
  const langVar = `lang${i++}`
  outTop += `\nimport ${langVar} from 'highlight.js/lib/languages/${langFile || lang}'`
  outBottom += `hljs.registerLanguage('${lang}', ${langVar})\n`
}

for (const file of fs.readdirSync('node_modules/highlight.js/lib/languages')) {
  if (file.endsWith('.js.js')) continue

  const lang = file.replace(/\.js$/, '')

  if (ignoredLangs.includes(lang)) continue
  addLang(lang, lang)
}

addLang('pgsql', 'sql')

console.log(outTop + '\n\n' + outBottom)

fs.writeFileSync(
  'src/utils/highlight-imports.ts',
  `// This file is autogenerated from scripts/generate-hljs-imports.js

${outTop}

${outBottom}`,
)
